# chapter 4. 부호화와 발전

### 1. 들어가면서...

- 신제품 출시, 사용자 요구사항 변경, 비즈니스 환경 변화 등으로 데이터 및 애플리케이션은 변화함.

- 이 때 시스템에서 과거 버전과 신 버전이 공존하는데, 시스템이 계속 양방향으로 원활하게 실행되게 하려면 호환성 유지가 필요함.

  - 즉, 데이터베이스에서 변화를 가져오며, 컬럼이나 필드가 추가되거나 삭제되기도 함

- 어떻게 시스템 상에서 스키마를 변경하고 과거 & 현재 데이터 타입과 코드가 공존하는지 설명하는 챕터

### 2. 데이터 부호화 형식

- 네트워크로 데이터를 전송하거나 파일에 쓰려면 일련의 바이트열 형태로 부호화함.

- 인메모리 상태에서의 바이트열 전환을 부호화(직렬화, 마샬링), 그 반대를 복호화라함 (역직렬화, 파싱, 언마샬링).

- 부호화는 보통 프로그래밍 언어와 엮여 있어서, 다른 언어가 읽기 무척 어려움. (자바 java.io.Serializable, 루비 Marshal, 파이썬 pickle)

- 효율성, 데이터 버전관리, 보안 이슈 등으로 언어에 내장된 부호화를 사용하는 것은 일반적으로 권장 안함.

### 3. Json, XML, 이진 변형

- 수(number) 의 부호화에 애매한 부분이 존재함. 특히, 큰 수를 다룰 때 부동소수점을 다루는 언어들에서 파싱할 때 부정확해짐.

- Json & XML은 유니코드 문자열은 지원하지만, 바이너리 문자열은 지원안함. 그래서 Base64로 부호화해 이런 상황을 피함.

- 잘 알려져 있고, 많은 곳에서 표준화된 부호화 형식으로 사용하고 있음.

### 4. 이진 부호화

- 조직 내에서만 사용하는 데이터라면 최소공통분모 부호화 형식을 사용해야 부담감이 덜하다.

- Json & XML에 비해 더 적은 공간을 차지하고, 더 간결하며, 더 빠른 파싱을 가능하게함.

### 5. 스리프트와 프로토콜 버퍼

- 스리프트

  - 페이스북에서 개발한 이진 부호화 프로토콜

- 프로토콜 버퍼

  - 구글에서 개발한 이진 부호화 프로토콜. Data Pipeline Orchestration 툴에서 많이 차용해서 사용함 (예: Flyte)

- 아브로

  - 하둡의 서브 프로젝트로 시작한 프로토콜.
  - 핵심 아이디어는 쓰기 스키마와 읽기 스키마가 동일하지 않아도 되며, 단지 호환 가능하면 됨.
  - 데이터의 타입 변경이 가능함.
  - 쓰기 스키마
    - 많은 양의 레코드가 있는 대용량 파일
    - 개별적으로 기록된 레코드를 갖고 있는 DB
    - 네트워크 연결을 통해 데이터 보내기
  - 동적 생성 스키마
    - 스키마에 태그 번호가 없음 -> 스리프트나 프로토콜 버퍼에 비해 강점으로 꼽힘.

- 3개 프로토콜 모두 스키마 언어를 사용해 이진 부호화 기술함.

### 6. 데이터 플로우 모드

- 메모리를 공유하지 않는 일부 데이터를 보내고자하는 상황 가정.

- 전달 방법

  - DB를 통해서
    - 현재 실행 중인 스크립트는 예전 코드고, 새로운 데이터가 DB에 기록된 경우
    - 부호화 -> 복호화 -> 재부호화 하는 과정에서 데이터 유실 가능성. 해결하기 어려운 문제는 아님.
    - 백업 목적 또는 데이터 적재 목적으로 수시로 스냅샷을 구성해 별도 스토리지에 저장하는 방식.
      - 아브로와 같은 객체 컨테이너 보관 방식에 적합
  - 서비스 호출을 통해서
    - 서비스 지향 설계 -> 마이크로 서비스 설계
    - REST 설계 철학, SOAP(Simple Object Access Protocol) 프로토콜을 사용해서 데이터 전송 가능
    - 원격 프로시저 호출 (RPC, Remote Procedure Call) : 네트워크 요청을 같은 프로세스 안에서 특정 프로그래밍 함수나 메소드를 호출하는 것과 동일하게 사용하게 해줌.
      - 원격 서비스로부터 응답 못받는 경우
      - 응답만 유실되는 경우
      - 네트워크 latency (혼잡하거나 서비스 과부하 이슈)
      - 네트워크를 통해 전송하는 객체 크기가 커서 로컬 메모리에 못 올리는 경우
      - 클라이언트와 서비스가 서로 다른 프로그래밍 언어로 작업되었을 때, 데이터 타입을 맞춰줘야하는 이슈
      - 그럼에도 RPC는 널리 사용되고 있고, RPC 프레임 워크의 주요 초점은 같은 데이터 센터 내의 같은 조직이 소유한 서비스간 요청에 있음.
  - 비동기 메세지 전달을 통해서
    - 메세지를 직접 네트워크로 연결하지 않고 브로커 (또는 메세지 큐) 메세지 지향 미들웨어를 거쳐 전송
    - 수신자가 사용 불가능하나, 네트워크 과부하 등에서 버퍼처럼 사용해서 데이터 안정성 높임.
    - 죽었던 프로세스를 다시 보낼 수 있어 데이터 유실 방지 (AWS SQS Dead Letter Queue)\
    - 송신자가 수신자의 포트나 ip를 알 필요 없음.
    - 하나의 메세지를 여러 수신자에게 전송 가능
    - 논리적으로 송신자 <-> 수신자는 분리됨 (Publisher <-> Consumer)
