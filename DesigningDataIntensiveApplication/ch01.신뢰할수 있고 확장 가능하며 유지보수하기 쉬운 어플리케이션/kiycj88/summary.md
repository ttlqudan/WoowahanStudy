# 파트1. 데이터 시스템의 기초

# chapter 1. 신뢰할수 있고 확장 가능하며 유지보수하기 쉬운 어플리케이션
- 오늘날 많은 애플리케이션은 data-intensive. 결국, 데이터를 어떻게 다루느냐가 중요하다.

## 데이터 시스템에 대한 생각
오늘날의 소프트웨어 시스템에서 중요하게 여기는 세 가지
- 신뢰성: 결함이 발생하더라도 시스템이 지속적으로 올바르게 동작해야 한다.
- 확장성: 데이터, 트래픽, 복잡도가 증가함에 따라서 이를 잘 처리할수 있는 방법이 있어야 한다.
- 유지보수성: 여러 사람들이 계속적으로 시스템 상에서 생산적으로 작업할수 있게 해야 한다.


## 신뢰성
"무언가 잘못되더라도 지속적으로 올바르게 동작함"

결함과 장애
- 결함: 잘못 될수 있는 일 => 결함을 예측하고 대처할 수 있는 시스템 "내결함성(fault-tolerant)" OR "탄력성(resilient)"
- 장애: 사용자에게 필요한 서비스를 제공하지 못하고 시스템 전체가 멈춘 경우 => 결함으로 인해 장애가 발생하지 않게끔 내결함성 구조를 설계하는 것이 좋다.

### 하드웨어 결함
하드웨어 장애는 늘상 발생한다. 하드웨어 장애로 인한 시스템 장애를 줄이기 위한 방법으로 각 하드웨어 구성요소에 중복(redundency)를 추가하였다. (단일 장비의 장애를 방지하기 위한 방법)
- DISK RAID 구성
- hot-swap cpu 구성
- 예비 전원용 발전기
  애플리케이션의 스케일이 커지면서 사용하는 하드웨어가 많아지게 되고, 하드웨어 결함율도 증가하게 되었다. 단일 장비 신뢰성보다 유연성(flexibilty)와 탄력성(elasticity)를 우선적으로 처리하게끔 설계하기 시작
- 단일 장비보다 전체 장비의 손실을 견딜수 있는 시스템으로 변경되는 추세

### 소프트웨어 오류
특정 상황에서만 발생하는 경우가 많기 떄문에 예측하기도 수정하기도 쉽지 않다. 이를 해결하기 위해서는 테스트, 프로세스 격리, 죽은 프로세스의 재시작 허용, 모니터링 등이 도움이 될 수 있다.

### 인적 오류
"사람이 제일 미덥지 못하다!"
- 오류의 가능성을 최소화하는 방향으로 시스템을 설계하라
- 사람이 가장 많이 실수하는 부분에서 사람의 실수로 장애가 발생할수 있는 부분을 분리하다
- 단위 테스트부터 전체 시스템 통합 테스트와 수동 테스트까지 모든 수준에서 철저하게 테스트하라
- 장애 발생의 영향을 최소화하기 위해 인적 오류를 빠르고 쉽게 복구할 수 있게 하라
- 성능 지표와 오류율 같은 상세하고 명확한 모니터링 대책을 마련하라


## 확장성
- "시스템이 특정 방식으로 커지면 이에 대처하기 위한 선택은 무엇인가?"
- "추가 부하를 다루기 위해 계싼 자원을 어떻게 투입할까?"
### 부하 기술하기
부하 매개변수
- tps
- db read/write 비율
- active user
- cache hit ratio
- etc...

트위터의 fan-out 예시
- 방법1.
    - Write: Global Tweet Table에 데이터 Insert
    - Read: 매번 자신이 팔로우하고 있는 사람의 트윗을 join해서 Read - Read 부하가 높다
        - 자신이 팔로우하고 있는 유저 수와 비례 (followee count)
- 방법2.
    - Write: 팔로워의 홈 타임라인에 Tweet 전송 - Write 부하
        - 자신을 팔로우하고 있는 유저 수와 비례 (follower count)
    - Read: 홈 타임라인 Read

Wrtie에 비해 Read Traffic이 훨씬 높기 떄문에 방법2가 유용하였다. 다만, 팔로워 수 만큼 Tweet Write에 부하가 생긴다. 그래서 트위터는 하이브리드 채택
- 대부분은 followee가 많지 않기 때문에 방법2 사용, 팔로워 수가 많은 소수 사용자에 대해서는 follower 수와 연관이 있는 방법2를 사용하지 않고, 방법1을 사용
### 성능 기술하기
- 부하 매개변수를 증가시키고 시스템 자원은 변경하지 않고 유지하면 시스템 성능은 어떻게 영향을 받을까?
- 부하 매개변수를 증가시켰을 때 성능이 변하지 않고 유지되길 원한다면 얼마나 많이 자원을 늘려야 할까?

주로 사용하는 지표
- 처리량 - ex) qps, tps, rps
- 응답시간
    - 평균보다는 percentile을 주로 이용
    - tail latency: 보통 응답시간이 가장 느린 요청을 경험하는 고객들은 데이터를 많이 가지고 있기 때문(충성고객).
        - 아마존의 경우, p999 응답시간이 100ms wmdrkgkaus vksaofiddl 1% 줄어들고, 1s가 줄어들면 고객만족도 지표 16% 줄어드는 현상 확인
### 부하 대응 접근 방식
- scail-up: 장비 사양을 올린다
- scail-out: 장비 수를 늘린다
    - sharedd-nothing
    - auto-scailing

"one-size-fits-all 아키텍처는 없다."

## 유지보수성
레거시를 줄이기 위한 설계원칙
- 운영성: 운영팀이 시스템을 원활하게 운영할 수 있게 쉽게 만들어라.
- 단순성: 시스템에서 복잡도를 최대한 제거하여 새로운 엔지니어가 시스템을 이해하기 쉽게 만들어라
- 발전성: 엔지니어가 이후에 시슽메을 쉽게 변경할 수 있게 하라.

### 운용성: 운영의 편리함 만들기
"좋은 운영성이란 동일하게 반복되는 태스크를 쉽게 수행하게끔 만들어 운영팀이 고부가가치 활동에 노력을 집중한다는 의미"

### 단순성: 복잡도 관리
복잡도를 줄이기 위한 최상의 도구는 "추상화"

### 발전성: 변화를 쉽게 만들기
요구사항은 수시로 바뀌기 떄문에, 이를 대응하기 위해 시스템의 단순화와 추상화가 중요하다. 