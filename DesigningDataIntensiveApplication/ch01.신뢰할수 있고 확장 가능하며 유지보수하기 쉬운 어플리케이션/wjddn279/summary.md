# 1장. 신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 어플리케이션

## 개요

오늘날의 많은 어플리케이션은 “계산 중심” 에서 “데이터 중심” 으로 변모

- 주된 문제(병목)가 하드웨어 성능의 문제에서 데이터의 크기, 복잡도, 변화 속도의 문제

데이터 중심 어플리케이션은 공통으로 필요로 하는 기능을 제공하는 표준 구성 요소로 만듬

일반적으로 아래와 같은 기능들이 필요

- 나중에 다시 데이터를 찾을 수 있게 데이터를 저장 (데이터베이스 mysql)
- 읽기 속도 향상을 위해 값비싼 수행 결과를 기억 (캐쉬 redis)
- 키워드로 데이터를 검색하거나 필터링 할수 있게끔 제공 (검색 색인 es)
- 비동기 처리를 위해 다른 프로세스로 메세지 보내기 (스트림 처리 kafka)
- 대량의 누적된 데이터를 분석 (일괄처리 mapreduce)

애플리케이션을 만들 때 어떤 도구와 어떤 접근 방식이 적합한지 항상 고민해야함

## 데이터 시스템에 대한 생각

데이터 시스템 이라는 포괄적인 용어로 묶는 이유 - 데이터 저장 + 처리

1. 새로운 도구들은 다양한 사용 사례에 최적화 됐기 때문에 전통적인 분류에 맞지 않음
2. 현대의 많은 애플리케이션이 단일 도구로는 처리 + 저장을 만족시키지 못하기 때문에 단일 도구에서 알맞은 task단위로 나눠서 만들어짐

따라서 각 도구를 결합할 때 적절한 추상화 레벨과 인터페이스 노출이 중요하고, 그러한 시스템을 설계해야 한다.

책에서 강조하는 세가지 관심사는 다음과 같다

- 신뢰성
- 확장성
- 유지보수성

## 신뢰성

시스템이 올바르게 동작함, 즉 무언가 잘못되더라도 지속적으로 올바르게 동작함 (failover)

결함 - 잘못 될 수 있는 일

내결함성 - 결함을 예측하고 대처 할 수 있는 시스템의 속성

장애는 사용자가 원하는 서비스를 제공하지 못하는 상태이며, 결함과 동일하지 않고 결함이 원인이 될 수 있다.

일반적인 결함의 유형은 아래와 같다

### 하드웨어 결함

장비의 결함으로 인해 시스템이 장애로 빠지는 경우도 많다.

디스크, cpu, 네트워크, 파워 등 수많은 요소가 있다.

최근엔 소프트웨어 내결함성 기술 혹은 하드웨어 중복성으로 전체 장비의 손실을 견딜 수 있는 시스템으로 변경

### 소프트웨어 오류

시스템 내 체계적 오류 - 일부 노드의 장애로 인해 다른 노드로 장애가 확산되는 경우

- 공유 자원을 과도하게 사용하는 일부 프로세스 (hadoop yarn)
- 부하로 인해 반응이 없거나 잘못된 응답을 반환
- 한 구성 요소의 작은 결함이 다른 구성요소의 결함을 야기하여 연쇄 장애를 유발

테스트, 모니터링을 철저히 해야한다.

### 인적 오류

휴먼 에러이며, 잘못된 개발 사항 등 사람의 실수로 인해 발생하는 에러

- 오류를 최소화 할 수 있는 설계를 지향하자 - 추상화, 인터페이스 분리
- 샌드박스 환경 운용
- 철저한 테스트
- 롤백이나 롤 아웃등 언제나 장애에 대비하고 원복이 가능하도록 한다
- 지표, 인프라 등 모니터링을 철저히 하자
- 조작, 실습 교육을 진행하라

## 확장성

현재 시스템이 미래에도 잘 동작할 거라는 보장이 없다. - 부하에 대한 문제를 예상하고 확장을 고려해야 한다.

### 부하 기술하기

부하 매게변수를 측정해야한다 - 부하에 영향을 주는 변수들을 책정한다.

### 성능 기술하기

성능을 판정하는 기준?

처리량 - 초당 처리 할 수 있는 레코드 수나 일정 크기의 데이터 집합으로 작업을 수행할 때 걸리는 시간

응답시간 - 클라이언트가 요청을 보내고 응답을 받는 사이의 시간

### 부하 대응 접근 방식

본격적으로 확장에 대한 생각을 해야한다.

- 용량 확장 (수직 확장)
    - 하나의 강력한 장비의 사양을 업그레이드
- 규모 확장 (수평 확장)
    - 다수의 낮은 사양 장비의 대수를 늘리는 형태