# Chapter 2. 개략적인 규모 추정

- 보편적으로 통용되는 성능 수치상에서 사고 실험을 진행하여 성능 수치상에서 사고 실험을 행하여 추정치를 계산하는 행위

## 1. 2의 제곱수

- 최소 단위 1 Byte, 이는 8 Bit로 구성

- ASCII 문자 하나가 메모리에서 차지하는 크기가 1 Byte



| 2의 X 제곱 |        근사치        |    이름    | 축약형 |
| :--------: | :------------------: | :--------: | :----: |
|    2^10    |    1천 (Thousand)    | 1 KiloByte |  1KB   |
|    2^20    |   1백만 (Million)    | 1 MegaByte |  1MB   |
|    2^30    |    10억 (Billion)    | 1 GigaByte |  1GB   |
|    2^40    |    1조 (Trillion)    | 1 TeraByte |  1TB   |
|    2^50    | 1000조 (Quadrillion) | 1 PetaByte |  1PB   |



## 2. 모든 프로그래머가 알아야하는 응답지연 값



|                    연산명                     |        시간         |
| :-------------------------------------------: | :-----------------: |
|                 L1 캐시 참조                  |        0.5ns        |
|      분기 예측 오류 (Branch Mispredict)       |         5ns         |
|                 L2 캐시 참조                  |         7ns         |
|            뮤텍스 (Mutex) 락/언락             |        100ns        |
|                주 메모리 참조                 |        100ns        |
|                Zippy 1KB 압축                 |    10,000ns=10us    |
|          1 Gbps 네트워크로 2 KB 전송          |    20,000ns=20us    |
|           메모리에서 1MB 순차 Read            |   250,000ns=250us   |
| 같은 데이터 센터 내에서 메시지 왕복 지연 시간 |   500,000ns=500us   |
|              디스크 탐색 (Seek)               |  10,000,000ns=10ms  |
|          네트워크에서 1MB 순차 Read           |  10,000,000ns=10ms  |
|           디스크에서 1MB 순차 Read            |  30,000,000ns=30ms  |
|    한 패킷의 CA <-> 네덜란드 왕복 지연시간    | 150,000,000ns=150ms |

- 위 수치를 통해 얻을 수 있는 자료들
  - 메모리는 빠르지만 디스크는 아직 느림 (아마 HDD 기준인 것 같다)
  - 디스크 탐색은 가능한 피하자.
  - 단순 압축 알고리즘은 빠르다.

## 3. 가용성 관련 수치들

- 아래 자료는 AWS 가용 시간에 대한 공식 문서 사항

<img width="599" alt="image" src="https://github.com/ttlqudan/WoowahanStudy/assets/40455392/04915f4a-5381-4e30-a930-d8e5890d06fa">

## 4. 예제: Twitter QPS와 저장소 요구량 추정

- 연습용 데이터이고, 실제 수치와는 전혀 관계 없음

- 가정
  - MAU -> 3억명
  - 50% 사용자가 매일 트위터 사용 (retention)
  - 평균적으로 각 사용자는 매일 2건의 트윗 올림
  - 미디어 포함 트윗은 전체 트윗의 10% 수준
  - 데이터는 5년간 저장
- QPS 추정
  - DAU = 3억 x 50% -> 1.5억명
  - QPS = 1.5억 x 2트윗 / 24시간 / 3600초 = 약 3500
  - 최대 QPS = 2 x QPS = 약 7000
- 미디어 저장 위한 저장소 요구량
  - 평균 트윗 크기
    - Twitt_id -> 64KB
    - Text -> 140 Byte
    - Media -> 1MB
  - 미디어 저장소 요구량 = 1.5억 x 2 x 10% x 1 MB = 30 TB / 일
  - 5년 저장소 저장 시, 최소 55PB 필요.



## 5. 팁

- 면접 장소에서 수치가 맞냐, 안맞냐 보다 결과를 내는 게 중요함.
- 단위는 꼼꼼하게 기록하고, 계산 추정하는 연습을 잘 해놓자.